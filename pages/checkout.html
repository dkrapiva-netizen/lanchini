<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Äî LANCHINI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="container header__inner">
      <a href="../index.html" class="header__logo">LANCH<span>INI</span></a>
      <nav class="header__nav" id="nav">
        <a href="../index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="about.html">–û –Ω–∞—Å</a>
        <a href="delivery.html">–î–æ—Å—Ç–∞–≤–∫–∞</a>
        <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </nav>
      <div class="header__actions">
        <div class="header__search">
          <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫...">
          <button class="header__search-btn" id="search-btn">&#128269;</button>
        </div>
        <a href="cart.html" class="header__cart" id="cart-icon">
          &#128722;
          <span class="header__cart-count" id="cart-count" style="display:none;">0</span>
        </a>
        <button class="header__burger" id="burger" aria-label="–ú–µ–Ω—é">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- BREADCRUMB -->
  <div class="container">
    <div class="breadcrumb">
      <a href="../index.html">–ì–ª–∞–≤–Ω–∞—è</a> <span>&#8250;</span> <a href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a> <span>&#8250;</span> –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
    </div>
  </div>

  <!-- CHECKOUT -->
  <section class="checkout-page">
    <div class="container">
      <h1 class="checkout-page__title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>

      <div class="checkout-layout">
        <form class="checkout-form" id="checkout-form">

          <div class="checkout-form__group">
            <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <div class="form-row">
              <div class="form-field">
                <label for="name">–ò–º—è *</label>
                <input type="text" id="name" name="name" required>
              </div>
              <div class="form-field">
                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                <input type="tel" id="phone" name="phone" required placeholder="+7 (___) ___-__-__">
              </div>
            </div>
            <div class="form-row">
              <div class="form-field form-field--full">
                <label for="email">E-mail</label>
                <input type="email" id="email" name="email" placeholder="–¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞">
              </div>
            </div>
          </div>

          <div class="checkout-form__group">
            <h3>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
            <div class="form-row">
              <div class="form-field form-field--full">
                <label for="city">–ì–æ—Ä–æ–¥ *</label>
                <input type="text" id="city" name="city" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-field form-field--full">
                <label for="address">–ê–¥—Ä–µ—Å (—É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞) *</label>
                <input type="text" id="address" name="address" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-field">
                <label for="zip">–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å</label>
                <input type="text" id="zip" name="zip">
              </div>
              <div class="form-field">
                <label for="delivery">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <select id="delivery" name="delivery">
                  <option value="courier">–ö—É—Ä—å–µ—Ä</option>
                  <option value="post">–ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏</option>
                  <option value="cdek">–°–î–≠–ö</option>
                </select>
              </div>
            </div>
          </div>

          <div class="checkout-form__group">
            <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
            <div class="form-row">
              <div class="form-field form-field--full">
                <label for="comment">–ü–æ–∂–µ–ª–∞–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É</label>
                <textarea id="comment" name="comment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –∑–∞ —á–∞—Å –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏"></textarea>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn--primary btn--full">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </form>

        <!-- ORDER SUMMARY -->
        <div class="cart-summary" id="order-summary">
          <!-- Injected by JS -->
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <div class="footer__inner">
        <div>
          <div class="footer__brand">LANCH<span>INI</span></div>
          <p class="footer__about">–ú—ã —Å–æ–∑–¥–∞—ë–º –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ —á–∞–π–Ω—ã–µ –ø–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–æ—Å—è—Ç —Ä–∞–¥–æ—Å—Ç—å –∏ —É–∫—Ä–∞—à–∞—é—Ç —á–∞–µ–ø–∏—Ç–∏–µ.</p>
        </div>
        <div>
          <h4 class="footer__heading">–ú–∞–≥–∞–∑–∏–Ω</h4>
          <div class="footer__links">
            <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="about.html">–û –Ω–∞—Å</a>
            <a href="delivery.html">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a>
          </div>
        </div>
        <div>
          <h4 class="footer__heading">–ü–æ–º–æ—â—å</h4>
          <div class="footer__links">
            <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
            <a href="delivery.html">–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å</a>
          </div>
        </div>
        <div>
          <h4 class="footer__heading">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
          <div class="footer__links">
            <a href="tel:+79991234567">+7 (999) 123-45-67</a>
            <a href="mailto:hello@lanchini.ru">hello@lanchini.ru</a>
          </div>
        </div>
      </div>
      <div class="footer__bottom">&copy; 2025 LANCHINI. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
    </div>
  </footer>

  <div class="notification" id="notification"></div>

  <script src="../js/data.js"></script>
  <script src="../js/cart.js"></script>
  <script src="../js/app.js"></script>
  <script>
    const TG_TOKEN = '8399901516:AAHPlNobhUb37QV044xsbIddPaYZI9Es49g';
    const TG_CHAT_ID = '112222064';

    document.addEventListener('DOMContentLoaded', () => {
      const items = Cart.getItems();
      const summary = document.getElementById('order-summary');
      const total = Cart.getTotal();

      if (items.length === 0) {
        window.location.href = 'cart.html';
        return;
      }

      let itemsHTML = '';
      items.forEach(item => {
        const p = products.find(pr => pr.id === item.id);
        if (!p) return;
        itemsHTML += `
          <div class="cart-summary__row">
            <span>${p.name} x${item.qty}</span>
            <span>${(p.price * item.qty).toLocaleString('ru-RU')} &#8381;</span>
          </div>
        `;
      });

      summary.innerHTML = `
        <h3 class="cart-summary__title">–í–∞—à –∑–∞–∫–∞–∑</h3>
        ${itemsHTML}
        <div class="cart-summary__row">
          <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
          <span>${total >= 5000 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : '490 &#8381;'}</span>
        </div>
        <div class="cart-summary__row cart-summary__row--total">
          <span>–ò—Ç–æ–≥–æ</span>
          <span>${(total >= 5000 ? total : total + 490).toLocaleString('ru-RU')} &#8381;</span>
        </div>
      `;

      // Phone validation
      document.getElementById('phone').addEventListener('input', function() {
        const digits = this.value.replace(/\D/g, '');
        if (digits.length > 0 && digits.length < 10) {
          this.setCustomValidity('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–º–∏–Ω–∏–º—É–º 10 —Ü–∏—Ñ—Ä)');
        } else {
          this.setCustomValidity('');
        }
      });

      // Form submit ‚Äî send to Telegram
      document.getElementById('checkout-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = e.target.querySelector('[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

        const name = document.getElementById('name').value;
        const phone = document.getElementById('phone').value;
        const email = document.getElementById('email').value;
        const city = document.getElementById('city').value;
        const address = document.getElementById('address').value;
        const zip = document.getElementById('zip').value;
        const delivery = document.getElementById('delivery').value;
        const comment = document.getElementById('comment').value;

        const deliveryNames = { courier: '–ö—É—Ä—å–µ—Ä', post: '–ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏', cdek: '–°–î–≠–ö' };
        const deliveryFree = total >= 5000;
        const orderTotal = deliveryFree ? total : total + 490;

        let itemsText = '';
        items.forEach(item => {
          const p = products.find(pr => pr.id === item.id);
          if (p) itemsText += `  ‚Ä¢ ${p.name} x${item.qty} ‚Äî ${(p.price * item.qty).toLocaleString('ru-RU')} ‚ÇΩ\n`;
        });

        const message = `üõç <b>–ù–û–í–´–ô –ó–ê–ö–ê–ó ‚Äî LANCHINI</b>\n\n`
          + `üë§ <b>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:</b> ${name}\n`
          + `üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${phone}\n`
          + (email ? `üìß <b>Email:</b> ${email}\n` : '')
          + `\nüìç <b>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</b>\n`
          + `–ì–æ—Ä–æ–¥: ${city}\n`
          + `–ê–¥—Ä–µ—Å: ${address}\n`
          + (zip ? `–ò–Ω–¥–µ–∫—Å: ${zip}\n` : '')
          + `–°–ø–æ—Å–æ–±: ${deliveryNames[delivery] || delivery}\n`
          + `\nüõí <b>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</b>\n${itemsText}`
          + `\nüí∞ –¢–æ–≤–∞—Ä—ã: ${total.toLocaleString('ru-RU')} ‚ÇΩ\n`
          + `üöö –î–æ—Å—Ç–∞–≤–∫–∞: ${deliveryFree ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : '490 ‚ÇΩ'}\n`
          + `üí≥ <b>–ò–¢–û–ì–û: ${orderTotal.toLocaleString('ru-RU')} ‚ÇΩ</b>`
          + (comment ? `\n\nüí¨ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> ${comment}` : '');

        try {
          const response = await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: TG_CHAT_ID, text: message, parse_mode: 'HTML' })
          });

          const result = await response.json();

          if (result.ok) {
            Cart.clear();
            document.querySelector('.checkout-page .container').innerHTML = `
              <div style="text-align:center;padding:80px 0;">
                <div style="font-size:4rem;margin-bottom:16px;">&#10004;</div>
                <h1 class="checkout-page__title">–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!</h1>
                <p style="color:var(--text-light);font-size:1.1rem;margin-bottom:24px;">–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</p>
                <a href="../index.html" class="btn btn--primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
              </div>
            `;
          } else {
            throw new Error('Telegram error');
          }
        } catch (err) {
          submitBtn.disabled = false;
          submitBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑';
          showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º: +7 (999) 123-45-67');
        }
      });
    });
  </script>
</body>
</html>
